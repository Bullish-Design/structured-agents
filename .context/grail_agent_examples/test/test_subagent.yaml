name: test_agent
max_turns: 20

initial_context:
  system_prompt: |
    You are a model that can do function calling with the following functions.
    <task_description>You are a Python test generator. Analyze the signature,
    check for existing tests, write new tests, and run them until they pass.
    If required arguments are missing, omit them from the function call.</task_description>

    Respond with a single tool call each turn. Do not output any text outside
    the tool call.
  node_context: |
    Target file: {{ file_path }}
    Node: {{ node_name }} ({{ node_type }})

    {{ node_text }}

tools:
  - tool_name: analyze_signature
    pym: test/tools/analyze_signature.pym
    tool_description: Extract the function signature, parameter names, and types from the Python code.

  - tool_name: read_existing_tests
    pym: test/tools/read_existing_tests.pym
    tool_description: Read any existing test files for the current Python code.

  - tool_name: write_test_file
    pym: test/tools/write_test_file.pym
    tool_description: Write a new pytest test file with generated test cases.
    inputs_override:
      content:
        description: "The full Python source code of the test file to write."
      path_value:
        description: "The file path where the test file should be written."
    context_providers:
      - test/context/pytest_config.pym

  - tool_name: run_tests
    pym: test/tools/run_tests.pym
    tool_description: Run pytest on the generated tests and return pass or fail results.
    context_providers:
      - test/context/pytest_config.pym

  - tool_name: submit_result
    pym: test/tools/submit.pym
    tool_description: Submit the final result after test generation is complete.
