from grail import Input

code: str = Input("code", description="The source code to generate a docstring for")
function_name: str | None = Input("function_name", description="Optional specific function name to document", default=None)

try:
    lines = [line for line in code.split("\n") if line.strip()]
    
    target_func = None
    func_start = -1
    func_end = -1
    
    if function_name:
        for i, line in enumerate(lines):
            if f"def {function_name}" in line or f"async def {function_name}" in line:
                target_func = line.strip()
                func_start = i
                break
    
    if target_func is None:
        for i, line in enumerate(lines):
            if line.strip().startswith(("def ", "async def ")):
                target_func = line.strip()
                func_start = i
                break
    
    if target_func:
        func_lines = []
        indent = len(lines[func_start]) - len(lines[func_start].lstrip()) if func_start >= 0 else 0
        
        for i in range(func_start + 1, len(lines)):
            line = lines[i]
            if line.strip() and not line.startswith(" " * (indent + 1)) and not line.startswith("\t"):
                func_end = i
                break
            func_lines.append(line)
        
        if func_end == -1:
            func_end = len(lines)
        
        func_code = "\n".join(func_lines[:10])
        
        result = {
            "docstring": f'"""{target_func.split("(")[0].replace("def ", "").replace("async def ", "")} - Auto-generated docstring.\n\nArgs:\n    (See function parameters)\n\nReturns:\n    (Return value description)\n"""',
            "function_detected": target_func,
            "code_snippet": func_code,
        }
    else:
        result = {
            "docstring": '"""Auto-generated docstring.\n\nArgs:\n    (See function parameters)\n\nReturns:\n    (Return value description)\n"""',
            "function_detected": None,
            "error": "No function definition found",
        }
        
except Exception as exc:
    result = {"error": str(exc)}

result
